---
layout: post
status: publish
published: true
title: MODx Редирект с index, index.html, index.php на главную страницу
author:
  display_name: z1m
  login: z1m
  email: z1m@tut.by
  url: ''
author_login: z1m
author_email: z1m@tut.by
wordpress_id: 174
wordpress_url: http://extazystas.ru/?p=174
date: '2012-04-24 18:09:51 +0300'
date_gmt: '2012-04-24 16:09:51 +0300'
categories:
- MODx
tags: []
comments:
- id: 124
  author: Владимир
  author_email: kav@ural-mep.ru
  author_url: ''
  date: '2012-11-05 11:29:18 +0300'
  date_gmt: '2012-11-05 09:29:18 +0300'
  content: Не работает. Как грузилось с index.php так и грузится
- id: 125
  author: z1m
  author_email: z1m@tut.by
  author_url: ''
  date: '2012-11-12 16:37:36 +0300'
  date_gmt: '2012-11-12 14:37:36 +0300'
  content: "Владимир, можете уточнить, сайт на MODx или нет? что конкретно делали?\r\nПутей
    всегда много, чтобы выполнить редирект."
- id: 126
  author: Master
  author_email: akramotra1@mail.ru
  author_url: ''
  date: '2012-12-01 22:16:56 +0300'
  date_gmt: '2012-12-01 20:16:56 +0300'
  content: "Старый сайт у меня был чисто на php и  ссылки у меня были вот такого вида
    ( view_price.php?id=6 )\r\nкак теперь их перенести на простые ссылки типа /1/1.html
    \r\nчет ни где найти не могу.. у меня modx EVO 1.0.5"
- id: 129
  author: z1m
  author_email: z1m@tut.by
  author_url: ''
  date: '2012-12-21 10:38:13 +0300'
  date_gmt: '2012-12-21 08:38:13 +0300'
  content: а <a href="http://www.google.ru/search?hl=ru&q=%D0%A7%D0%9F%D0%A3+url+modx+evo"
    title="тут" rel="nofollow"></a> смотрели?
- id: 130
  author: Machine
  author_email: Masqwsa@gmail.com
  author_url: ''
  date: '2013-01-13 15:13:03 +0300'
  date_gmt: '2013-01-13 13:13:03 +0300'
  content: скажите, а обязательно создавать в папках htaccess, если без них переадресация
    работает и в админку нормально захожу
- id: 131
  author: Machine
  author_email: Masqwsa@gmail.com
  author_url: ''
  date: '2013-01-13 15:50:23 +0300'
  date_gmt: '2013-01-13 13:50:23 +0300'
  content: Я ошибся... ошибка вылазит
- id: 132
  author: Денис
  author_email: denis.demut@mail.ru
  author_url: ''
  date: '2013-03-06 22:48:13 +0300'
  date_gmt: '2013-03-06 20:48:13 +0300'
  content: "есил в директории(кор,манагер и т.д) разместить такой файл - получим 403
    ошибку, либо ошибку при сохранении\r\nзато редирект с индекс.пхп работает\r\nвариант
    - разрешать с ип, по проверке досупа и т.д, либо вместо Deny - Allow писать, или
    вобще не заливать в директории"
- id: 133
  author: z1m
  author_email: z1m@tut.by
  author_url: ''
  date: '2013-03-07 10:45:19 +0300'
  date_gmt: '2013-03-07 08:45:19 +0300'
  content: Я бы не постил, если бы не проверил это :) Смотря какой modx видимо. А
    вообще php Зло
- id: 134
  author: Дмитрий
  author_email: cuk44@yandex.ru
  author_url: ''
  date: '2013-03-26 14:12:37 +0300'
  date_gmt: '2013-03-26 12:12:37 +0300'
  content: В моем это не работает
- id: 135
  author: z1m
  author_email: z1m@tut.by
  author_url: ''
  date: '2013-03-28 13:24:32 +0300'
  date_gmt: '2013-03-28 11:24:32 +0300'
  content: Может сторонний код в htaccess блокирует?
- id: 137
  author: Den1a
  author_email: den1a@yandex.ru
  author_url: ''
  date: '2013-04-13 18:39:00 +0300'
  date_gmt: '2013-04-13 16:39:00 +0300'
  content: "Минут 40 лазил в нете и не мог найти верный редирект. www склеил, а вот
    ..../index.php все равно грузился.\r\nИ о чудо! \r\nВоспользовался вашим методом
    и все стало перенаправлять. \r\nСпасибо."
- id: 138
  author: z1m
  author_email: z1m@tut.by
  author_url: ''
  date: '2013-04-13 21:37:04 +0300'
  date_gmt: '2013-04-13 19:37:04 +0300'
  content: Рад, что вам помогло! :)
- id: 139
  author: Dmitry
  author_email: dlazarin@mail.ru
  author_url: ''
  date: '2013-05-08 11:34:57 +0300'
  date_gmt: '2013-05-08 09:34:57 +0300'
  content: Спасибо, верное решение! )
- id: 142
  author: Юлия
  author_email: utka-go@bk.ru
  author_url: ''
  date: '2013-07-11 13:24:12 +0300'
  date_gmt: '2013-07-11 11:24:12 +0300'
  content: А с modx Evolution сработает?
- id: 145
  author: z1m
  author_email: z1m@tut.by
  author_url: ''
  date: '2013-07-22 10:51:49 +0300'
  date_gmt: '2013-07-22 08:51:49 +0300'
  content: Нужно попробовать. Сейчас не имею такой возможности. Для evo может быть
    даже проще... ИМХО
- id: 149
  author: KEFIR
  author_email: chirurg@inbox.ru
  author_url: http://ok-dok.ru
  date: '2013-08-09 15:46:21 +0300'
  date_gmt: '2013-08-09 13:46:21 +0300'
  content: "Не проще в роботсе закрыть и не парить мозг?\r\n\r\nDisallow: /*.php$"
- id: 156
  author: z1m
  author_email: z1m@tut.by
  author_url: ''
  date: '2013-09-25 15:40:42 +0300'
  date_gmt: '2013-09-25 13:40:42 +0300'
  content: Это можно, но мне кажется это больше похоже на полу-меру
- id: 157
  author: Олег
  author_email: tyuns89.89@mail.ru
  author_url: ''
  date: '2013-10-11 16:13:37 +0300'
  date_gmt: '2013-10-11 14:13:37 +0300'
  content: "У меня админ не открывается, пишет 500.\r\nЯ добавил вроде .htaccess во
    все папки, как и было сказано, что делать?)"
- id: 158
  author: z1m
  author_email: z1m@tut.by
  author_url: ''
  date: '2013-11-05 12:35:47 +0300'
  date_gmt: '2013-11-05 10:35:47 +0300'
  content: Пожалуйста уточняйте версию вашего MODx
- id: 159
  author: Василий
  author_email: bazilio100lei@gmail.com
  author_url: http://bazmaster.ru
  date: '2013-11-25 09:19:55 +0300'
  date_gmt: '2013-11-25 07:19:55 +0300'
  content: Ваш код невозможно скопировать. Защита ваша нещадно вырезает при копировании.
    Приходится вручную перепечатывать...
- id: 160
  author: Василий
  author_email: bazilio100lei@gmail.com
  author_url: http://bazmaster.ru
  date: '2013-11-25 09:22:44 +0300'
  date_gmt: '2013-11-25 07:22:44 +0300'
  content: Но за код спасибо - очень помог!
- id: 161
  author: z1m
  author_email: z1m@tut.by
  author_url: ''
  date: '2013-11-25 10:15:55 +0300'
  date_gmt: '2013-11-25 08:15:55 +0300'
  content: Есть такое. Отключу наверно ее
- id: 162
  author: z1m
  author_email: z1m@tut.by
  author_url: ''
  date: '2013-11-25 10:16:06 +0300'
  date_gmt: '2013-11-25 08:16:06 +0300'
  content: На здоровье!
- id: 173
  author: Aksmed
  author_email: medyza4ka@gmail.com
  author_url: ''
  date: '2014-06-05 12:23:15 +0300'
  date_gmt: '2014-06-05 10:23:15 +0300'
  content: "У меня этот способ заработал, отлично.\r\nОгромное спасибо."
- id: 176
  author: z1m
  author_email: z1m@tut.by
  author_url: ''
  date: '2014-06-13 18:23:44 +0300'
  date_gmt: '2014-06-13 16:23:44 +0300'
  content: на здоровье!!
- id: 178
  author: Darya
  author_email: shpitsi@yandex.ru
  author_url: ''
  date: '2014-06-16 11:12:40 +0300'
  date_gmt: '2014-06-16 09:12:40 +0300'
  content: 'Здравствуйте! Подскажите, есть ли какое-нибудь решение: на сайте редирект
    на без index.php, но не работают комментарии в к2 (не добавляются). Если убрать
    этот редирект из htacess, все работает.'
- id: 179
  author: z1m
  author_email: z1m@tut.by
  author_url: ''
  date: '2014-06-19 16:28:04 +0300'
  date_gmt: '2014-06-19 14:28:04 +0300'
  content: может в функционале комментариев используется запрос, который идет на index.php
    - и попадает в бесконечный редирект? Тут не угадаешь, надо смотреть напрямую.
    Я больше не работаю с apache и php, поэтому подсказать не смогу.
- id: 180
  author: Darya
  author_email: shpitsi@yandex.ru
  author_url: ''
  date: '2014-06-20 08:51:07 +0300'
  date_gmt: '2014-06-20 06:51:07 +0300'
  content: Спасибо за ответ! Пришлось пока убрать редирект на без index.php. А индекс
    закрыть в роботсе.
- id: 196
  author: ykppon
  author_email: ykppon@yandex.ru
  author_url: ''
  date: '2015-01-14 12:54:34 +0300'
  date_gmt: '2015-01-14 10:54:34 +0300'
  content: "Сделал все как описано, но при попытке войти в админку говорит об отсутствии
    доступа:\r\n\r\nForbidden\r\n\r\nYou don't have permission to access /mymanager/
    on this server."
- id: 202
  author: z1m
  author_email: z1m@tut.by
  author_url: ''
  date: '2015-03-13 17:15:32 +0300'
  date_gmt: '2015-03-13 15:15:32 +0300'
  content: Ищите косяк в .htacess
- id: 205
  author: Alex
  author_email: dedyshkam@gmail.com
  author_url: http://lero-auto.ru/
  date: '2015-04-05 17:02:26 +0300'
  date_gmt: '2015-04-05 15:02:26 +0300'
  content: "Аналогичная проблема как у ykppon.\r\nЕсли убрать .htaccess из папки manager
    работает, но криво, точнее сказать не работает админка )\r\nВерсия: MODX Revolution
    2.3.1-pl :("
- id: 211
  author: Konstantin
  author_email: Kostja_L@mail.ru
  author_url: http://garden-cosmetics.ru
  date: '2015-10-15 11:41:04 +0300'
  date_gmt: '2015-10-15 09:41:04 +0300'
  content: "Не надо портить .htaccess в папках ModX. Добавьте к правилу следующие
    строки и все будет ОК:\r\n\r\nRewriteCond %{REQUEST_URI} !^/assets/(.*)$\r\nRewriteCond
    %{REQUEST_URI} !^/core/(.*)$\r\nRewriteCond %{REQUEST_URI} !^/connectors/(.*)$\r\nRewriteCond
    %{REQUEST_URI} !^/manager/(.*)$"
- id: 212
  author: Павел
  author_email: pavet@supersite.su
  author_url: http://christcore.ru/
  date: '2015-11-06 17:59:20 +0300'
  date_gmt: '2015-11-06 15:59:20 +0300'
  content: Настроил на сайте .htaccess по твоей системе, все работает, спасибо! =)
- id: 213
  author: Сергей
  author_email: mmo_repr@mail.ru
  author_url: ''
  date: '2015-11-15 14:03:38 +0300'
  date_gmt: '2015-11-15 12:03:38 +0300'
  content: "Сделал как у Вас. Но строки \r\nRewriteCond %{THE_REQUEST} ^.*/index\r\nRewriteRule
    ^(.*)index http://site.ru/$1 [R=301,L]\r\n\r\nприводят к выдаче сообщения \"Доступ
    закрыт\" при сохранении ресурса."
- id: 216
  author: z1m
  author_email: z1m@tut.by
  author_url: ''
  date: '2016-01-29 14:01:50 +0300'
  date_gmt: '2016-01-29 12:01:50 +0300'
  content: Извините, этому посту много лет, возможно что-то изменилось, я давно не
    пользовался MODX Revo
---
<p>Каждый оптимизатор сталкивался с проблемой дублирования контента и "склейкой" таких страниц. Я не исключение, сегодня мы будем делать редирект (переадресацию) со всевозможных index* на главную страницу сайта на примере <strong>MODx Revolution 2.1</strong> с помощью файла .htaccess.</p>
<p align="center"><a href="http://extazystas.ru/wp-content/uploads/2012/04/redirekt.jpg"><img src="http://extazystas.ru/wp-content/uploads/2012/04/redirekt.jpg" alt="301 redirect" title="redirect" width="400" height="250" class="alignleft size-full wp-image-188" /></a></p>
<p><strong><!--more Читать дальше >>--></strong><br />
Хороший хостинг по умолчанию редиректит с Index.php на главную страницу сайта. Но когда это не работает, мы получаем дубль главной страницы, что не является хорошим фактом для продвижения вашего сайта.</p>
<h3>Итак, <span style="color:red">варианты, которые не работают.</span></h3>
<p>Для начала, я решил воспользоваться стандартным решением для редиректа с index.html на главную страницу сайта:</p>
{% highlight javascript %}
Options +FollowSymLinks
RewriteEngine On
RewriteCond %{THE_REQUEST} ^.*/index.php
RewriteRule ^(.*)index.php$ http://site.ru/$1 [R=301,L]
{% endhighlight %}
<p>Но в результате получил неработающую админку - action_err_ns и "Доступ закрыт". Хотя сам редирект на сайте работал.<br />
Затем я попробовал следующий вариант:</p>
{% highlight javascript %}
RewriteRule ^index.php$ / [R=301,L]
{% endhighlight %}
<p>И страницы сайта превратились из site.ru/about в site.ru/?q=about.</p>
<h3>Повозившись и посоветовавшись пришел к <span style="color:green">работающему решению:</span></h3>
<blockquote><p>Чтобы сделать редирект с /index, /index.html И /index.php на главную страницу сайта в MODx Revolution нужно прописать в .htaccess:</p></blockquote>
{% highlight javascript %}
Options +FollowSymLinks
RewriteEngine On
RewriteBase /
RewriteCond %{HTTP_HOST} !^site.ru$ [NC]
RewriteRule ^(.*)$ http://site.ru/$1 [R=301,L] # склейка домена с и без www

RewriteCond %{THE_REQUEST} ^.*/index.html
RewriteRule ^(.*)index.html$ http://site.ru/$1 [R=301,L]

RewriteCond %{THE_REQUEST} ^.*/index
RewriteRule ^(.*)index http://site.ru/$1 [R=301,L]

<IfModule mod_dir.c>
DirectoryIndex index.php index.html
</IfModule>

RewriteCond %{THE_REQUEST} ^.*/index.php
RewriteCond %{QUERY_STRING} ^$
RewriteRule ^(.*)index.php$ http://site.ru/$1 [R=301,L]
{% endhighlight %}
<p><span style="color:red">+ для корректной работы необходимо добавить в папки assets, connectors, core, manager файл .htaccess с кодом:</span></p>
{% highlight javascript %}
RewriteEngine Off

IndexIgnore */*
<Files *.php>
    Order Deny,Allow
    Deny from all
</Files>
{% endhighlight %}
<p><strong>Всё, мы получили рабочие 301 редиректы и работающую админку. Надеюсь было интересно.</strong><br />
<i>Если кто-нибудь знает варианты проще - прошу комментировать.</i></p>
